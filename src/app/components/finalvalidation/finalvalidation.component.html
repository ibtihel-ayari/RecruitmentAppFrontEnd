<div class="ml-72 p-8">
  <div class="bg-white p-10 rounded-3xl shadow-2xl space-y-8">
    <h5 class="text-2xl font-bold text-gray-800">Scores des candidatures validées par offre</h5>

    <div *ngIf="isLoading" class="flex justify-center">
      <div class="animate-spin rounded-full h-8 w-8 border-4 border-blue-500 border-t-transparent"></div>
    </div>

    <div *ngIf="errorMessage" class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded">
      {{ errorMessage }}
    </div>

<div *ngFor="let offer of jobOffers" class="bg-gray-50 border border-gray-200 rounded-xl shadow-md">
  <div class="text-blue-800 px-6 py-4 rounded-t-xl" [ngStyle]="{ 'background-color': 'rgba(59, 130, 246, 0.3)' }">
    <h6 class="text-xl font-semibold">{{ offer.title }}</h6>
    <p class="text-sm opacity-90">{{ offer.location }} - {{ offer.type }}</p>
  </div>


      <div class="p-6">
        <div *ngIf="!getApplicationsForOffer(offer.id)?.length" class="bg-blue-100 text-blue-800 p-4 rounded-lg text-center">
          Aucune candidature pré-sélectionnée pour cette offre.
        </div>

        <div *ngIf="getApplicationsForOffer(offer.id)?.length" class="overflow-x-auto">
          <table class="min-w-full text-sm text-left text-gray-700">
            <thead class="bg-gray-200 text-gray-600 uppercase text-xs">
              <tr>
                <th class="px-6 py-3">Candidat</th>
                <th class="px-6 py-3">Date de candidature</th>
                <th class="px-6 py-3">Score</th>
                <th class="px-6 py-3">Statut</th>
                <th class="px-6 py-3">Action</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
              <tr *ngFor="let application of getApplicationsForOffer(offer.id)" class="hover:bg-gray-50">
                <td class="px-6 py-4 font-medium">{{ getCandidateName(application.id, offer.id) }}</td>
                <td class="px-6 py-4">{{ application.submissionDate | date:'mediumDate' }}</td>
          
                <td class="px-6 py-4">
                  <div class="w-full bg-gray-200 rounded-full h-4">
                    <div
                      class="h-4 rounded-full text-xs text-white flex items-center justify-center"
                      [ngClass]="{
                        'bg-green-500': getCandidateScore(application.id, offer.id) >= 70,
                        'bg-yellow-500': getCandidateScore(application.id, offer.id) >= 50 && getCandidateScore(application.id, offer.id) < 70,
                        'bg-red-500': getCandidateScore(application.id, offer.id) < 50
                      }"
                      [style.width.%]="getCandidateScore(application.id, offer.id)"
                    >
                      {{ getCandidateScore(application.id, offer.id) }}%
                    </div>
                  </div>
                </td>
                      <td class="px-6 py-4">
                  <span
                    class="inline-block px-3 py-1 rounded-full text-xs font-semibold"
                    [ngClass]="{
                      'bg-green-100 text-green-700': application.status === 'Accepté',
                      'bg-red-100 text-red-700': application.status === 'Refusé',
                      'bg-yellow-100 text-yellow-700': application.status === 'En attente'
                    }"
                  >
                    {{ application.status }}
                  </span>
                </td>
                <td class="px-6 py-4">
                  <div class="flex space-x-2">
                    <button 
                      (click)="updateStatus(application, 'Accepté')"
                      class="px-3 py-1 bg-green-100 text-green-700 rounded-full text-xs font-semibold hover:bg-green-200"
                      [class.bg-green-300]="application.status === 'Accepté'"
                    >
                      Accepter
                    </button>
                    <button 
                      (click)="updateStatus(application, 'Refusé')"
                      class="px-3 py-1 bg-red-100 text-red-700 rounded-full text-xs font-semibold hover:bg-red-200"
                      [class.bg-red-300]="application.status === 'Refusé'"
                    >
                      Refuser
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>